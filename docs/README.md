
# Исторический образовательный бот для Telegram

Этот проект представляет собой образовательного бота для Telegram, специализирующегося на истории России. Бот предлагает пользователям изучение исторических тем, тестирование знаний и ведение беседы по историческим вопросам.

## Содержание

1. [Архитектура проекта](#архитектура-проекта)
2. [Основные компоненты](#основные-компоненты)
3. [Установка и настройка](#установка-и-настройка)
4. [Конфигурация](#конфигурация)
5. [API интеграции](#api-интеграции)
6. [Тестирование](#тестирование)
7. [Руководство по расширению](#руководство-по-расширению)

## Архитектура проекта

Проект построен с использованием модульной архитектуры и следующих паттернов проектирования:
- **Factory** для создания и настройки компонентов
- **Service Locator** для централизованного управления сервисами
- **Dependency Injection** для управления зависимостями
- **Singleton** для объектов, которые должны существовать в единственном экземпляре

Подробное описание архитектуры доступно в [docs/architecture.md](architecture.md).

## Основные компоненты

Система состоит из следующих ключевых компонентов:

1. **Bot Core** (`src/bot.py`) - Основной компонент, отвечающий за взаимодействие с Telegram API
2. **API Client** (`src/api_client.py`) - Клиент для взаимодействия с Gemini API
3. **Service Container** (`src/service_container.py`) - Контейнер для управления сервисами
4. **Topic Service** (`src/topic_service.py`) - Сервис для работы с историческими темами
5. **Test Service** (`src/test_service.py`) - Сервис для генерации и проверки тестов
6. **Conversation Service** (`src/conversation_service.py`) - Сервис для ведения бесед
7. **UI Manager** (`src/ui_manager.py`) - Компонент для управления пользовательским интерфейсом
8. **Logger** (`src/logger.py`) - Система логирования

Полное описание компонентов API доступно в [docs/api_components.md](api_components.md).

## Установка и настройка

### Требования

- Python 3.9+
- Telegram Bot Token
- Google Gemini API ключ

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Настройка переменных окружения

Создайте файл `.env` в корневой директории проекта со следующим содержимым:

```
TELEGRAM_TOKEN=your_telegram_token_here
GEMINI_API_KEY=your_gemini_api_key_here
ADMIN_ID=your_telegram_id
```

## Конфигурация

Основные настройки бота находятся в файле `src/config.py`. Здесь вы можете настроить:
- Состояния диалога
- Интервалы повторных попыток
- Параметры кэширования
- Размеры пагинации

Настройки для администраторов находятся в файле `admins.json`.

## API интеграции

Бот интегрируется с Google Gemini API для генерации контента. Подробности интеграции:
- Для генерации информации о темах (`src/api_client.py::get_historical_info`)
- Для создания тестов (`src/api_client.py::generate_historical_test`)
- Для ответов на вопросы (`src/api_client.py::ask_grok`)

## Тестирование

Проект включает набор автоматических тестов в директории `tests/`. Для запуска тестов выполните:

```bash
python -m unittest discover tests
```

## Руководство по расширению

### Добавление новой команды

1. Определите обработчик команды в `src/handlers.py`
2. Зарегистрируйте команду в методе `setup_bot` в `src/bot.py`
3. При необходимости добавьте новое состояние в `src/config.py`

### Создание нового сервиса

1. Создайте класс сервиса в директории `src/`
2. Реализуйте методы сервиса
3. Зарегистрируйте сервис в `src/factory.py`
4. Добавьте сервис в контейнер в `src/service_container.py`

### Расширение аналитики

Для добавления новых метрик аналитики:
1. Добавьте методы сбора данных в `src/analytics.py`
2. Вызывайте эти методы в соответствующих обработчиках
